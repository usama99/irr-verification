<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRR Verification</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .login-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            margin: 100px auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .main-content {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        button:hover {
            opacity: 0.9;
        }

        .hidden {
            display: none !important;
        }

        .error {
            color: #dc3545;
            margin-top: 10px;
            font-size: 14px;
        }

        .as-search-section {
            margin-bottom: 30px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
        }

        .large-as-warning {
            padding: 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #856404;
        }

        .search-peer-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .search-results {
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .country-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .country-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .country-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .country-flag {
            font-size: 24px;
            margin-right: 10px;
        }

        .country-progress {
            font-size: 14px;
            color: #666;
        }

        .peer-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            transition: border-color 0.3s;
        }

        .peer-item:hover {
            border-color: #667eea;
        }

        .peer-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .peer-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .verification-options {
            display: flex;
            gap: 10px;
        }

        .verification-options label {
            flex: 1;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            font-size: 14px;
        }

        .verification-options input[type="radio"] {
            display: none;
        }

        .verification-options input[type="radio"]:checked + label {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .verification-options input[type="radio"][value="obsolete"]:checked + label {
            background: #dc3545;
            border-color: #dc3545;
        }

        .verification-options input[type="radio"][value="unknown"]:checked + label {
            background: #ffc107;
            border-color: #ffc107;
            color: #333;
        }

        .load-more-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            margin-top: 15px;
        }

        .clear-btn {
            background: #6c757d;
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        .verification-summary {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .submit-section {
            margin-top: 30px;
            text-align: center;
        }

        .submit-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            font-size: 18px;
            padding: 15px;
        }

        .contact {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="loginSection" class="login-section">
            <h1>üîí Verification Portal</h1>
            <p class="subtitle">Enter password to continue</p>
            <input type="password" id="passwordInput" placeholder="Password" onkeypress="if(event.key==='Enter') login()">
            <button onclick="login()">Login</button>
            <div id="loginError" class="error hidden">Incorrect password</div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="main-content hidden">
            <h1>IRR Link Verification</h1>
            <p class="subtitle">Verify peering relationships for your AS</p>

            <!-- AS Search -->
            <div class="as-search-section">
                <input type="text" id="asnInput" placeholder="Enter AS Number (e.g., 174)" oninput="searchAS()">
                <div id="asResults" class="hidden"></div>
            </div>

            <!-- Stats -->
            <div id="statsSection" class="stats hidden">
                <div class="stat-box">
                    <div class="stat-label">AS Number</div>
                    <div class="stat-value" id="currentASN">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Peers</div>
                    <div class="stat-value" id="totalPeers">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Countries</div>
                    <div class="stat-value" id="countryCount">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Verified</div>
                    <div class="stat-value" id="verifiedCount">0</div>
                </div>
            </div>

            <!-- Large AS Warning -->
            <div id="largeAsWarning" class="large-as-warning hidden">
                <strong>‚ö†Ô∏è Large AS</strong><br>
                This AS has many peers. They are loaded in pages of 50 for better performance.
            </div>

            <!-- Peer Search -->
            <div id="peerSearchSection" class="search-peer-section hidden">
                <h3 style="margin-bottom: 10px;">üîç Search Peer</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <input
                        type="text"
                        id="peerSearchInput"
                        placeholder="Search by AS number or name"
                        style="flex: 1; margin-bottom: 0;"
                        oninput="searchPeers()">
                    <button class="clear-btn" onclick="clearPeerSearch()">Clear</button>
                </div>
                <div id="searchResults" class="search-results hidden"></div>
            </div>

            <!-- Country Groups -->
            <div id="countryGroupsContainer"></div>

            <!-- Verification Summary -->
            <div id="verificationSummary" class="verification-summary hidden">
                <h3>‚úì Summary</h3>
                <div id="summaryContent"></div>
            </div>

            <!-- Submit -->
            <div class="submit-section">
                <button class="submit-btn" onclick="submitVerification()">Submit</button>
                <p class="subtitle" style="margin-top: 10px;">
                    Data will be saved automatically
                </p>
            </div>

            <div class="contact">
                <strong>Questions?</strong> Contact: usamaijaz404@gmail.com
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================

        const PASSWORD_HASH = "deda38a7fa94cdc6863168750cac646efa25ff2e2a67babe979b46c3cb36b9ee";
        const PEERS_PER_PAGE = 50;
        const LARGE_AS_THRESHOLD = 1000;
        const MAX_SEARCH_RESULTS = 50;

        // Country flags
        const FLAGS = {
            'United States': 'üá∫üá∏', 'United Kingdom': 'üá¨üáß', 'Germany': 'üá©üá™',
            'France': 'üá´üá∑', 'Netherlands': 'üá≥üá±', 'Canada': 'üá®üá¶',
            'Japan': 'üáØüáµ', 'Australia': 'üá¶üá∫', 'Singapore': 'üá∏üá¨',
            'Hong Kong': 'üá≠üá∞', 'India': 'üáÆüá≥', 'Brazil': 'üáßüá∑',
            'Russia': 'üá∑üá∫', 'China': 'üá®üá≥', 'South Korea': 'üá∞üá∑',
            'Switzerland': 'üá®üá≠', 'Sweden': 'üá∏üá™', 'Italy': 'üáÆüáπ',
            'Spain': 'üá™üá∏', 'Poland': 'üáµüá±', 'Belgium': 'üáßüá™',
            'Austria': 'üá¶üáπ', 'Denmark': 'üá©üá∞', 'Norway': 'üá≥üá¥',
            'Finland': 'üá´üáÆ', 'Ireland': 'üáÆüá™', 'Czech Republic': 'üá®üáø',
            'Portugal': 'üáµüáπ', 'Romania': 'üá∑üá¥', 'Greece': 'üá¨üá∑',
            'Hungary': 'üá≠üá∫', 'Ukraine': 'üá∫üá¶', 'Thailand': 'üáπüá≠',
            'Malaysia': 'üá≤üáæ', 'Indonesia': 'üáÆüá©', 'Philippines': 'üáµüá≠',
            'Vietnam': 'üáªüá≥', 'Taiwan': 'üáπüáº', 'Turkey': 'üáπüá∑',
            'Israel': 'üáÆüá±', 'Saudi Arabia': 'üá∏üá¶', 'UAE': 'üá¶üá™',
            'South Africa': 'üáøüá¶', 'Mexico': 'üá≤üáΩ', 'Argentina': 'üá¶üá∑',
            'Chile': 'üá®üá±', 'Colombia': 'üá®üá¥', 'New Zealand': 'üá≥üáø'
        };

        // ============================================
        // STATE
        // ============================================

        let countryIndex = {};
        let currentASN = '';
        let currentASData = null;
        let peerVerifications = {};
        let sessionHistory = [];
        let countryPages = {};

        // ============================================
        // PASSWORD & LOGIN
        // ============================================

        async function sha256(str) {
            const buffer = new TextEncoder().encode(str);
            const hash = await crypto.subtle.digest('SHA-256', buffer);
            return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function login() {
            const password = document.getElementById('passwordInput').value;
            const hash = await sha256(password);

            if (hash === PASSWORD_HASH) {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                loadCountryIndex();
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        // ============================================
        // DATA LOADING
        // ============================================

        async function loadCountryIndex() {
            try {
                const response = await fetch('country_index.json');
                countryIndex = await response.json();
                console.log('Country index loaded');
            } catch (error) {
                console.error('Error loading country index:', error);
                alert('Error loading data. Please refresh the page.');
            }
        }

        function searchAS() {
            const input = document.getElementById('asnInput').value;
            const asn = input.replace(/\D/g, '');

            if (asn.length > 0) {
                currentASN = asn;
                loadASData(asn);
            }
        }

        async function loadASData(asn) {
            const country = countryIndex[asn];

            if (!country) {
                alert('AS not found in database');
                return;
            }

            try {
                const response = await fetch(`${country}.json`);
                const data = await response.json();

                if (!data[asn]) {
                    alert('AS data not found');
                    return;
                }

                currentASData = data[asn];
                peerVerifications = {};
                countryPages = {};

                displayASInfo();
                renderCountryGroups();

                document.getElementById('statsSection').classList.remove('hidden');
                document.getElementById('peerSearchSection').classList.remove('hidden');

                if (currentASData.links.length > LARGE_AS_THRESHOLD) {
                    document.getElementById('largeAsWarning').classList.remove('hidden');
                } else {
                    document.getElementById('largeAsWarning').classList.add('hidden');
                }

                updateVerificationSummary();

            } catch (error) {
                console.error('Error loading AS data:', error);
                alert('Error loading AS data');
            }
        }

        function displayASInfo() {
            document.getElementById('currentASN').textContent = currentASN;
            document.getElementById('totalPeers').textContent = currentASData.links.length;

            const countries = new Set(currentASData.links.map(l => l.country || 'Unknown'));
            document.getElementById('countryCount').textContent = countries.size;
            document.getElementById('verifiedCount').textContent = '0';
        }

        // ============================================
        // RENDERING
        // ============================================

        function renderCountryGroups() {
            const container = document.getElementById('countryGroupsContainer');
            container.innerHTML = '';

            // Group by country
            const byCountry = {};
            currentASData.links.forEach(link => {
                const country = link.country || 'Unknown';
                if (!byCountry[country]) byCountry[country] = [];
                byCountry[country].push(link);
            });

            // Render each country group
            Object.keys(byCountry).sort().forEach(country => {
                const peers = byCountry[country];
                const flag = FLAGS[country] || 'üåê';

                const groupDiv = document.createElement('div');
                groupDiv.className = 'country-group';
                groupDiv.id = `group-${country}`;

                groupDiv.innerHTML = `
                    <div class="country-header">
                        <div>
                            <span class="country-flag">${flag}</span>
                            <span class="country-title">${country}</span>
                        </div>
                        <div class="country-progress" id="progress-${country}">
                            0 / ${peers.length} verified
                        </div>
                    </div>
                    <div id="peers-${country}"></div>
                `;

                container.appendChild(groupDiv);

                // Initialize page counter
                countryPages[country] = 1;

                // Render first page
                const firstPage = peers.slice(0, PEERS_PER_PAGE);
                renderPeers(country, firstPage);

                // Add load more button if needed
                if (peers.length > PEERS_PER_PAGE) {
                    const loadMoreBtn = document.createElement('button');
                    loadMoreBtn.className = 'load-more-btn';
                    loadMoreBtn.textContent = `Load More (${peers.length - PEERS_PER_PAGE} remaining)`;
                    loadMoreBtn.onclick = () => loadMorePeers(country);
                    loadMoreBtn.id = `loadmore-${country}`;
                    groupDiv.appendChild(loadMoreBtn);
                }
            });
        }

        function renderPeers(country, peers) {
            const container = document.getElementById(`peers-${country}`);

            peers.forEach(peer => {
                const peerDiv = document.createElement('div');
                peerDiv.className = 'peer-item';
                peerDiv.id = `peer-${peer.asn}`;

                peerDiv.innerHTML = `
                    <div class="peer-header">AS${peer.asn}</div>
                    <div class="peer-info">${peer.name || 'No name available'}</div>
                    <div class="verification-options">
                        <input type="radio" name="peer-${peer.asn}" id="active-${peer.asn}" value="active" onchange="updateVerification('${peer.asn}', 'active', '${country}')">
                        <label for="active-${peer.asn}">‚úì Active</label>

                        <input type="radio" name="peer-${peer.asn}" id="obsolete-${peer.asn}" value="obsolete" onchange="updateVerification('${peer.asn}', 'obsolete', '${country}')">
                        <label for="obsolete-${peer.asn}">‚úó Obsolete</label>

                        <input type="radio" name="peer-${peer.asn}" id="unknown-${peer.asn}" value="unknown" onchange="updateVerification('${peer.asn}', 'unknown', '${country}')">
                        <label for="unknown-${peer.asn}">? Unknown</label>
                    </div>
                `;

                container.appendChild(peerDiv);
            });
        }

        function loadMorePeers(country) {
            const byCountry = {};
            currentASData.links.forEach(link => {
                const c = link.country || 'Unknown';
                if (!byCountry[c]) byCountry[c] = [];
                byCountry[c].push(link);
            });

            const peers = byCountry[country];
            const currentPage = countryPages[country];
            const nextPage = currentPage + 1;

            const start = currentPage * PEERS_PER_PAGE;
            const end = start + PEERS_PER_PAGE;
            const nextPeers = peers.slice(start, end);

            renderPeers(country, nextPeers);
            countryPages[country] = nextPage;

            // Update or remove load more button
            const loadMoreBtn = document.getElementById(`loadmore-${country}`);
            if (end >= peers.length) {
                loadMoreBtn.remove();
            } else {
                loadMoreBtn.textContent = `Load More (${peers.length - end} remaining)`;
            }
        }

        // ============================================
        // VERIFICATION
        // ============================================

        function updateVerification(asn, status, country) {
            peerVerifications[asn] = status;

            // Update country progress
            updateCountryProgress(country);

            // Update global count
            document.getElementById('verifiedCount').textContent = Object.keys(peerVerifications).length;

            // Update summary
            updateVerificationSummary();
        }

        function updateCountryProgress(country) {
            const byCountry = {};
            currentASData.links.forEach(link => {
                const c = link.country || 'Unknown';
                if (!byCountry[c]) byCountry[c] = [];
                byCountry[c].push(link);
            });

            const peers = byCountry[country];
            const verified = peers.filter(p => peerVerifications[p.asn]).length;

            document.getElementById(`progress-${country}`).textContent =
                `${verified} / ${peers.length} verified`;
        }

        function updateVerificationSummary() {
            if (Object.keys(peerVerifications).length === 0) {
                document.getElementById('verificationSummary').classList.add('hidden');
                return;
            }

            const active = Object.values(peerVerifications).filter(v => v === 'active').length;
            const obsolete = Object.values(peerVerifications).filter(v => v === 'obsolete').length;
            const unknown = Object.values(peerVerifications).filter(v => v === 'unknown').length;

            document.getElementById('summaryContent').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #28a745;">${active}</div>
                        <div style="color: #666;">Active</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #dc3545;">${obsolete}</div>
                        <div style="color: #666;">Obsolete</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #ffc107;">${unknown}</div>
                        <div style="color: #666;">Unknown</div>
                    </div>
                </div>
            `;

            document.getElementById('verificationSummary').classList.remove('hidden');
        }

        // ============================================
        // PEER SEARCH
        // ============================================

        function searchPeers() {
            const query = document.getElementById('peerSearchInput').value.toLowerCase().trim();
            const resultsDiv = document.getElementById('searchResults');

            if (query.length === 0) {
                resultsDiv.classList.add('hidden');
                return;
            }

            const matches = currentASData.links.filter(link => {
                const asn = link.asn.toString();
                const name = (link.name || '').toLowerCase();
                return asn.includes(query) || name.includes(query);
            }).slice(0, MAX_SEARCH_RESULTS);

            if (matches.length === 0) {
                resultsDiv.innerHTML = '<div style="padding: 10px; color: #666;">No matches found</div>';
                resultsDiv.classList.remove('hidden');
                return;
            }

            resultsDiv.innerHTML = '';
            matches.forEach(peer => {
                const country = peer.country || 'Unknown';
                const peerDiv = document.createElement('div');
                peerDiv.className = 'peer-item';

                peerDiv.innerHTML = `
                    <div class="peer-header">AS${peer.asn} - ${country}</div>
                    <div class="peer-info">${peer.name || 'No name available'}</div>
                    <div class="verification-options">
                        <input type="radio" name="peer-${peer.asn}" id="search-active-${peer.asn}" value="active" onchange="updateVerification('${peer.asn}', 'active', '${country}')">
                        <label for="search-active-${peer.asn}">‚úì Active</label>

                        <input type="radio" name="peer-${peer.asn}" id="search-obsolete-${peer.asn}" value="obsolete" onchange="updateVerification('${peer.asn}', 'obsolete', '${country}')">
                        <label for="search-obsolete-${peer.asn}">‚úó Obsolete</label>

                        <input type="radio" name="peer-${peer.asn}" id="search-unknown-${peer.asn}" value="unknown" onchange="updateVerification('${peer.asn}', 'unknown', '${country}')">
                        <label for="search-unknown-${peer.asn}">? Unknown</label>
                    </div>
                `;

                // Sync with existing selection if any
                if (peerVerifications[peer.asn]) {
                    const radio = peerDiv.querySelector(`input[value="${peerVerifications[peer.asn]}"]`);
                    if (radio) radio.checked = true;
                }

                resultsDiv.appendChild(peerDiv);
            });

            if (matches.length === MAX_SEARCH_RESULTS) {
                const moreDiv = document.createElement('div');
                moreDiv.style.padding = '10px';
                moreDiv.style.color = '#666';
                moreDiv.style.textAlign = 'center';
                moreDiv.textContent = `Showing first ${MAX_SEARCH_RESULTS} results`;
                resultsDiv.appendChild(moreDiv);
            }

            resultsDiv.classList.remove('hidden');
        }

        function clearPeerSearch() {
            document.getElementById('peerSearchInput').value = '';
            document.getElementById('searchResults').classList.add('hidden');
        }

        // ============================================
        // SUBMISSION
        // ============================================

        async function submitVerification() {
            if (Object.keys(peerVerifications).length === 0) {
                alert('Please verify at least one peer before submitting.');
                return;
            }

            const data = {
                asn: currentASN,
                as_info: currentASData.as_info,
                peer_verifications: peerVerifications,
                timestamp: new Date().toISOString(),
                total_peers: currentASData.links.length,
                verified_peers: Object.keys(peerVerifications).length,
                summary: {
                    active: Object.values(peerVerifications).filter(v => v === 'active').length,
                    obsolete: Object.values(peerVerifications).filter(v => v === 'obsolete').length,
                    unknown: Object.values(peerVerifications).filter(v => v === 'unknown').length
                }
            };

            // Download JSON locally for operator
            downloadJSONBackup(data);

            // Send to researcher
            await sendToResearcher(data);

            // Track session
            sessionHistory.push({
                asn: currentASN,
                verified_count: Object.keys(peerVerifications).length,
                timestamp: data.timestamp
            });

            // Show success and ask about next AS
            const continueVerifying = confirm(
                `‚úì AS${currentASN} verification submitted!\n\n` +
                `Verified: ${Object.keys(peerVerifications).length} peers\n\n` +
                `Data saved successfully.\n\n` +
                `Verify another AS?`
            );

            if (continueVerifying) {
                resetForNewAS();
            } else {
                showSessionSummary();
            }
        }

        function downloadJSONBackup(data) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AS${data.asn}_verification_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function sendToResearcher(data) {
            try {
                // Use FormSubmit.co for email delivery
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = 'https://formsubmit.co/usamaijaz404@gmail.com';
                form.target = '_blank';

                const subjectInput = document.createElement('input');
                subjectInput.type = 'hidden';
                subjectInput.name = 'subject';
                subjectInput.value = `AS${data.asn} IRR Verification`;
                form.appendChild(subjectInput);

                const dataInput = document.createElement('input');
                dataInput.type = 'hidden';
                dataInput.name = 'data';
                dataInput.value = JSON.stringify(data, null, 2);
                form.appendChild(dataInput);

                const timestampInput = document.createElement('input');
                timestampInput.type = 'hidden';
                timestampInput.name = 'timestamp';
                timestampInput.value = data.timestamp;
                form.appendChild(timestampInput);

                document.body.appendChild(form);
                form.submit();
                document.body.removeChild(form);

            } catch (error) {
                console.error('Send error:', error);
            }
        }

        function resetForNewAS() {
            document.getElementById('asnInput').value = '';
            document.getElementById('countryGroupsContainer').innerHTML = '';
            document.getElementById('statsSection').classList.add('hidden');
            document.getElementById('peerSearchSection').classList.add('hidden');
            document.getElementById('verificationSummary').classList.add('hidden');
            document.getElementById('largeAsWarning').classList.add('hidden');

            currentASN = '';
            currentASData = null;
            peerVerifications = {};
            countryPages = {};

            document.getElementById('asnInput').focus();
        }

        function showSessionSummary() {
            if (sessionHistory.length === 0) {
                return;
            }

            let summary = `‚úì Session Complete!\n\n`;
            summary += `You verified ${sessionHistory.length} AS${sessionHistory.length > 1 ? 'es' : ''}:\n\n`;

            sessionHistory.forEach(entry => {
                summary += `‚úì AS${entry.asn}: ${entry.verified_count} peer${entry.verified_count > 1 ? 's' : ''}\n`;
            });

            summary += `\nThank you for your contribution!`;

            alert(summary);
        }
    </script>
</body>
</html>